(function(e,t,n,r){function u(t){this.options=e.extend({},o,t);i=this.options;this._defaults=o;this._name=s;this.init()}var i="";var s="poller",o={url:"pollytfing",pols:[],last_active:(new Date).getTime(),run_count:0,poll_timer:false,default_delay:8e3,default_delay_cap:300,default_max_delay:16e3};u.prototype.init=function(){e("*").bind("mousemove keydown scroll",function(){if(((new Date).getTime()-i.last_active)/1e3>i.default_delay_cap)u.prototype.restart();i.last_active=(new Date).getTime()})};u.prototype.add=function(e){i.pols.push({id:e.id,type:e.type,ratio:e.ratio,func:e.func,value:e.value})};u.prototype.run=function(){var n=i.default_delay;var r=i.default_delay;var s=i.default_delay_cap;var o=i.default_max_delay;var a=((new Date).getTime()-i.last_active)/1e3;if(a>s/4)n=r+r/4;if(a>s/3)n=r+r/3;if(a>s/2)n=r+r/2;if(a>s)n=o;i.poll_timer=setTimeout(function(){var n=[];e.each(i.pols,function(e,t){if(i.run_count%t.ratio===0){n.push(t)}});if(n.length>0){e.ajax({url:i.url,type:"POST",data:{polls:JSON.stringify(n)},complete:function(n){if(n.responseJSON){e.each(n.responseJSON,function(n,r){switch(r.type){case"html":e(n).html(r.args);break;case"function":t[r.func](n,r.args);break}})}i.run_count=i.run_count+1;u.prototype.run()},dataType:"json"})}else{i.run_count=i.run_count+1;u.prototype.run()}},n)};u.prototype.restart=function(){t.clearTimeout(i.poll_timer);this.run()};e.fn.poller=function(t){var n=arguments;if(t===r||typeof t==="object"){if(!e.data(this,"plugin_"+s)){e.data(this,"plugin_"+s,new u(t))}}else if(typeof t==="string"&&t[0]!=="_"&&t!=="init"){var i;var o=e.data(this,"plugin_"+s);if(o instanceof u&&typeof o[t]==="function"){i=o[t].apply(o,Array.prototype.slice.call(n,1))}if(t==="destroy"){e.data(this,"plugin_"+s,null)}return i!==r?i:this}}})(jQuery,window,document)